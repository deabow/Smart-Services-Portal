{% extends 'base.html' %}

{% block title %}لوحة التحكم - خدمة المواطنين{% endblock %}

{% block page_indicator %}
<div class="page-indicator">
	<i class="fas fa-cogs"></i> لوحة التحكم - الموقع الرسمي للنائب احمد ابوزيد
</div>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<h2 class="mb-0" style="color: #1e40af;">
		<i class="fas fa-chart-line me-2"></i>
		لوحة التحكم
	</h2>
	<a href="{% url 'admin:index' %}" class="btn btn-primary">
		<i class="fas fa-user-shield me-2"></i>
		Django Admin
	</a>
</div>

<!-- Statistics Cards -->
<div class="row g-4 mb-5">
	<div class="col-md-3">
		<div class="card border-0 shadow-sm text-center">
			<div class="card-body p-4">
				<div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
					 style="width: 80px; height: 80px;">
					<i class="fas fa-users text-primary" style="font-size: 2rem; color: #1e40af !important;"></i>
				</div>
				<h3 class="text-primary mb-2" style="color: #1e40af !important;">{{ stats.users_count|default:0 }}</h3>
				<p class="text-muted mb-0">إجمالي المستخدمين</p>
			</div>
		</div>
	</div>
	
	<div class="col-md-3">
		<div class="card border-0 shadow-sm text-center">
			<div class="card-body p-4">
				<div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
					 style="width: 80px; height: 80px;">
					<i class="fas fa-file-alt text-success" style="font-size: 2rem; color: #10b981 !important;"></i>
				</div>
				<h3 class="text-success mb-2" style="color: #10b981 !important;">{{ stats.requests_count|default:0 }}</h3>
				<p class="text-muted mb-0">إجمالي الطلبات</p>
			</div>
		</div>
	</div>
	
	<div class="col-md-3">
		<div class="card border-0 shadow-sm text-center">
			<div class="card-body p-4">
				<div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
					 style="width: 80px; height: 80px;">
					<i class="fas fa-clock text-warning" style="font-size: 2rem; color: #f59e0b !important;"></i>
				</div>
				<h3 class="text-warning mb-2" style="color: #f59e0b !important;">{{ stats.completed_requests|default:0 }}</h3>
				<p class="text-muted mb-0">الطلبات المكتملة</p>
			</div>
		</div>
	</div>
	
	<div class="col-md-3">
		<div class="card border-0 shadow-sm text-center">
			<div class="card-body p-4">
				<div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
					 style="width: 80px; height: 80px;">
					<i class="fas fa-trophy text-info" style="font-size: 2rem; color: #3b82f6 !important;"></i>
				</div>
				<h3 class="text-info mb-2" style="color: #3b82f6 !important;">{{ stats.achievements_count|default:0 }}</h3>
				<p class="text-muted mb-0">الإنجازات</p>
			</div>
		</div>
	</div>
</div>

<!-- Visitor Statistics -->
<div class="row g-4 mb-5">
	<div class="col-md-12">
		<div class="card border-0 shadow-sm">
			<div class="card-header bg-transparent border-0">
				<h5 class="mb-0" style="color: #1e40af;">
					<i class="fas fa-chart-bar me-2"></i>
					إحصائيات الزوار
				</h5>
			</div>
			<div class="card-body">
				<div class="row g-3">
					<div class="col-md-3">
						<div class="text-center p-3 bg-light rounded">
							<i class="fas fa-globe text-primary mb-2" style="font-size: 2rem;"></i>
							<h4 class="mb-1">{{ visitor_stats.total_visits|default:0 }}</h4>
							<small class="text-muted">إجمالي الزيارات</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="text-center p-3 bg-light rounded">
							<i class="fas fa-calendar-day text-success mb-2" style="font-size: 2rem;"></i>
							<h4 class="mb-1">{{ visitor_stats.today_visits|default:0 }}</h4>
							<small class="text-muted">زيارات اليوم</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="text-center p-3 bg-light rounded">
							<i class="fas fa-user-check text-info mb-2" style="font-size: 2rem;"></i>
							<h4 class="mb-1">{{ visitor_stats.today_unique|default:0 }}</h4>
							<small class="text-muted">زوار فريدون اليوم</small>
						</div>
					</div>
					<div class="col-md-3">
						<div class="text-center p-3 bg-light rounded">
							<i class="fas fa-calendar-week text-warning mb-2" style="font-size: 2rem;"></i>
							<h4 class="mb-1">{{ monthly_total|default:0 }}</h4>
							<small class="text-muted">زيارات آخر 30 يوم</small>
						</div>
					</div>
				</div>
				
				<div class="row mt-3">
					<div class="col-md-6">
						<div class="text-center p-3 bg-success bg-opacity-10 rounded">
							<i class="fas fa-user-tie text-success mb-2" style="font-size: 1.5rem;"></i>
							<h5 class="mb-1">{{ visitor_stats.today_registered|default:0 }}</h5>
							<small class="text-muted">مستخدمون مسجلون اليوم</small>
						</div>
					</div>
					<div class="col-md-6">
						<div class="text-center p-3 bg-info bg-opacity-10 rounded">
							<i class="fas fa-user-secret text-info mb-2" style="font-size: 1.5rem;"></i>
							<h5 class="mb-1">{{ visitor_stats.today_guests|default:0 }}</h5>
							<small class="text-muted">زوار ضيوف اليوم</small>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Latest Requests -->
<div class="card border-0 shadow-sm">
	<div class="card-header bg-transparent border-0">
		<h5 class="mb-0" style="color: #1e40af;">
			<i class="fas fa-list me-2"></i>
			أحدث الطلبات
		</h5>
	</div>
	<div class="card-body p-0">
		{% if latest_requests %}
		<div class="table-responsive">
			<table class="table table-hover mb-0">
				<thead class="table-light">
					<tr>
						<th class="border-0" style="color: #1e40af;">رقم التتبع</th>
						<th class="border-0" style="color: #1e40af;">مقدم الطلب</th>
						<th class="border-0" style="color: #1e40af;">عنوان الطلب</th>
						<th class="border-0" style="color: #1e40af;">التاريخ</th>
						<th class="border-0" style="color: #1e40af;">الحالة</th>
						<th class="border-0" style="color: #1e40af;">الإجراءات</th>
					</tr>
				</thead>
				<tbody>
					{% for request in latest_requests %}
					<tr>
						<td class="align-middle">
							<strong class="text-primary">{{ request.tracking_number }}</strong>
						</td>
						<td class="align-middle">
							<div class="d-flex align-items-center">
								<div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center me-3" 
									 style="width: 35px; height: 35px;">
									<i class="fas fa-user text-primary" style="color: #1e40af !important; font-size: 0.9rem;"></i>
								</div>
								<div>
									<div class="fw-bold">{{ request.user.username }}</div>
									<small class="text-muted">{{ request.user.full_name|default:'' }}</small>
								</div>
							</div>
						</td>
						<td class="align-middle">
							{{ request.title|truncatechars:30 }}
						</td>
						<td class="align-middle">
							<small class="text-muted">{{ request.created_at|date:"Y/m/d" }}</small>
						</td>
						<td class="align-middle">
							{% if request.status.name == 'pending' %}
								<span class="badge bg-warning text-dark">
									<i class="fas fa-clock me-1"></i>
									قيد الانتظار
								</span>
							{% elif request.status.name == 'in_progress' %}
								<span class="badge bg-info text-white">
									<i class="fas fa-spinner me-1"></i>
									قيد المعالجة
								</span>
							{% elif request.status.name == 'completed' %}
								<span class="badge bg-success text-white">
									<i class="fas fa-check me-1"></i>
									مكتمل
								</span>
							{% elif request.status.name == 'rejected' %}
								<span class="badge bg-danger text-white">
									<i class="fas fa-times me-1"></i>
									مرفوض
								</span>
							{% else %}
								<span class="badge bg-secondary text-white">{{ request.status.name }}</span>
							{% endif %}
						</td>
						<td class="align-middle">
							<div class="btn-group" role="group">
								<a href="{% url 'requests:detail' request.tracking_number %}" class="btn btn-sm btn-outline-primary" 
								   style="border-color: #1e40af; color: #1e40af;">
									<i class="fas fa-eye"></i>
								</a>
								<a href="{% url 'admin:requests_app_request_change' request.id %}" class="btn btn-sm btn-outline-warning">
									<i class="fas fa-edit"></i>
								</a>
							</div>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="text-center py-4">
			<div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" 
				 style="width: 80px; height: 80px;">
				<i class="fas fa-file-alt text-primary" style="font-size: 2rem; color: #1e40af !important;"></i>
			</div>
			<h5 class="text-muted mb-2">لا توجد طلبات حالياً</h5>
			<p class="text-muted">سيتم عرض الطلبات هنا عند تقديمها</p>
		</div>
		{% endif %}
	</div>
</div>

<div class="text-center mt-4">
	<a href="{% url 'home' %}" class="btn btn-outline-primary" style="border-color: #1e40af; color: #1e40af;">
		<i class="fas fa-home me-2"></i>
	العودة للرئيسية
	</a>
</div>
{% endblock %}

